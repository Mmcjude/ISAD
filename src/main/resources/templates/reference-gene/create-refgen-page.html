<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Create Reference Gene</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

    <div th:replace="~{fragments/header :: header}"></div>
    <div class="main-content">
        <form th:action="@{/unit-of-genetics-and-breeding/reference-gene/create}" th:object="${refgen}" method="post" class="form-wrapper">
                <h2 class="form-title">Input Reference Gene Record:</h2>

                <div class="form-grid form-grid-single-column">
                    <div class="form-group">
                        <label for="referenceGeneId">Reference Gene ID:</label>
                        <input type="text" id="referenceGeneId" th:value="${'Autogenerated'}" class="form-input" disabled>
                    </div>

                    <div class="form-group">
                        <label for="sample">Sample:</label>
                        <select th:field="*{sample}" class="form-select choices-select" id="sample" name="sample.id" required>
                            <option th:each="tempS : ${samples}" 
                                    th:value="${tempS.sampleId}" 
                                    th:text="'ID ' + ${tempS.sampleId} + ' - ' + ${tempS.nucleicType} + ' - ' + ${#temporals.format(tempS.localDate, 'yyyy-MM-dd')} 
                                    + ' - ' + (${tempS.specie != null ? tempS.specie.name : 'No Species (NULL)'}) + ' (Variety: ' + (${tempS.plant != null && tempS.plant.variety != null ? tempS.plant.variety.name : 'No Variety (NULL)'}) + ')'">
                            </option>
                        </select>
                        <p class="form-error" th:if="${#fields.hasErrors('sample')}" th:errors="*{sample}">Sample Error</p>
                    </div>

                    <div class="form-group">
                        <label for="geneReferenceName">Name:</label>
                        <input type="text" id="geneReferenceName" minlength="2" maxlength="100"
                            title="Name must be between 2 and 100 characters long." 
                            th:field="*{geneReferenceName}" class="form-input auto-expand" required>
                        <p class="form-error" th:if="${#fields.hasErrors('geneReferenceName')}" th:errors="*{geneReferenceName}">Name Error</p>
                    </div>

                    <div class="form-group">
                        <label for="publicationReference">Publication Reference:</label>
                        <textarea id="publicationReference" minlength="5" maxlength="1000"
                            title="Publication Reference must be between 5 and 1000 characters long."
                            th:field="*{publicationReference}" class="form-input auto-expand" rows="2" required></textarea>
                        <p class="form-error" th:if="${#fields.hasErrors('publicationReference')}" th:errors="*{publicationReference}">Publication Reference Error</p>
                    </div>

                    <div class="form-group">
                        <label for="date">Date:</label>
                        <input type="date" 
                            id="date" 
                            class="form-input" 
                            name="date" 
                            required 
                            th:value="${refgen.date != null} ? ${#temporals.format(refgen.date, 'yyyy-MM-dd')} : ''" />
                        <p class="form-error" th:if="${#fields.hasErrors('date')}" th:errors="*{date}">Date Error</p>
                    </div>
            
                    <div class="form-group">
                        <label for="geneSequence">Gene Sequence:</label>
                        <textarea th:field="*{geneSequence}" rows="4" cols="40" class="form-input auto-expand" pattern="^[ACGTNU]+$"
                                    title="Gene sequence must contain only capital letters: A, C, G, T, N, or U." required>
                        </textarea>
                        <p class="form-error" th:if="${#fields.hasErrors('geneSequence')}" th:errors="*{geneSequence}">Gene Sequence Error</p>
                    </div>
                    
                </div>
            <div class="form-actions">
                <button class="form-submit" type="submit">Create Record</button>
            </div>
        </form>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.choices-select').forEach(function(select) {
                new Choices(select, {
                    searchEnabled: true,
                    itemSelectText: '',
                    maxItemCount: -1,
                    shouldSort: false
                });
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const textareas = document.querySelectorAll('.auto-expand');

            textareas.forEach(textarea => {
                textarea.addEventListener('input', function () {
                    this.style.height = '42px';
                    this.style.height = this.scrollHeight + 'px';
                });
            });
        });
    </script>

</body>
</html>
